extends layout

block content
  .container-fluid.mx-4.my-4
    //- Scrap Asset Header
    .row.mb-4
      .col-12
        h1.text-center.mb-4 Scrap Asset

    //- Form to Scrap Asset
    .row.mb-4
      .col-md-12
        .card.bg-light.border-primary.shadow-lg
          .card-body
            h5.card-title.text-primary Scrap Asset
            form(action='/assets/scrap/add' method='POST')
              .row
                .col-md-4.mb-3
                  .form-group
                    label(for='assetId') Asset
                    select.form-control(name='assetId' id='assetId' required)
                      option(value='') Select Asset
                      each asset in assets
                        option(value=asset.id)= `${asset.model} - ${asset.uniqueId}`
                .col-md-4.mb-3
                  .form-group
                    label(for='scrapDate') Scrap Date
                    input.form-control(type='date' id='scrapDate' name='scrapDate' required)
                .col-md-4.mb-3
                  .form-group
                    label(for='scrapReason') Scrap Reason
                    select.form-control(name='scrapReason' id='scrapReason' required)
                      option(value='') Select Reason
                      option(value='obsolete') Obsolete
                      option(value='damaged') Damaged
                      option(value='other') Other
              .form-group.mt-3
                button.btn.btn-primary.btn-lg(type='submit') Scrap Asset

    //- Scrapped Assets Table
    .row.mt-4
      .col-md-12
        .card.bg-light.border-primary.shadow-lg
          .card-body
            h5.card-title.text-primary Scrapped Assets
            .table-responsive
              table.table.table-striped.table-bordered#scrappedAssetsTable
                thead.bg-primary.text-white
                  tr
                    th Asset
                    th Scrap Date
                    th Scrap Reason
                    th Actions
                tbody
                  each scrap in scraps
                    tr
                      td= scrap.Asset ? `${scrap.Asset.model} - ${scrap.Asset.uniqueId}` : 'N/A'
                      td= scrap.scrapDate ? new Date(scrap.scrapDate).toLocaleDateString() : 'N/A'
                      td= scrap.scrapReason
                      td
                        button.btn.btn-warning.btn-sm(
                          data-toggle='modal'
                          data-target=`#editScrapModal-${scrap.id}`
                          ) Edit
                        button.btn.btn-danger.btn-sm(
                          data-toggle='modal'
                          data-target=`#deleteScrapModal-${scrap.id}`
                          ) Delete

    //- Edit Modal
    each scrap in scraps
      .modal.fade(id=`editScrapModal-${scrap.id}` tabindex='-1' role='dialog' aria-labelledby='editScrapModalLabel' aria-hidden='true')
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              h5.modal-title#editScrapModalLabel Edit Scrap Asset
              button.close(type='button' data-dismiss='modal' aria-label='Close')
                span(aria-hidden='true') &times;
            form(action=`/assets/scrap/edit/${scrap.id}` method='POST')
              .modal-body
                .form-group
                  label(for='assetId') Asset
                  select.form-control(name='assetId' id='assetId' required)
                    option(value='') Select Asset
                    each asset in assets
                      option(value=asset.id selected=scrap.assetId == asset.id)= `${asset.model} - ${asset.uniqueId}`
                .form-group
                  label(for='scrapDate') Scrap Date
                  input.form-control(type='date' id='scrapDate' name='scrapDate' value=`${scrap.scrapDate.toISOString().substring(0, 10)}` required)
                .form-group
                  label(for='scrapReason') Scrap Reason
                  select.form-control(name='scrapReason' id='scrapReason' required)
                    option(value='') Select Reason
                    option(value='obsolete' selected=scrap.scrapReason == 'obsolete') Obsolete
                    option(value='damaged' selected=scrap.scrapReason == 'damaged') Damaged
                    option(value='other' selected=scrap.scrapReason == 'other') Other
              .modal-footer
                button.btn.btn-secondary(type='button' data-dismiss='modal') Close
                button.btn.btn-primary(type='submit') Save changes

    //- Delete Modal
    each scrap in scraps
      .modal.fade(id=`deleteScrapModal-${scrap.id}` tabindex='-1' role='dialog' aria-labelledby='deleteScrapModalLabel' aria-hidden='true')
        .modal-dialog(role='document')
          .modal-content
            .modal-header
              h5.modal-title#deleteScrapModalLabel Delete Scrap Asset
              button.close(type='button' data-dismiss='modal' aria-label='Close')
                span(aria-hidden='true') &times;
            .modal-body
              p Are you sure you want to delete this scrap record?
            .modal-footer
              form(action=`/assets/scrap/delete/${scrap.id}` method='POST')
                button.btn.btn-secondary(type='button' data-dismiss='modal') Close
                button.btn.btn-danger(type='submit') Delete

  //- Scripts
  script(src='https://code.jquery.com/jquery-3.5.1.min.js')
  script(src='https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js')
  script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js')
  script.
    $(document).ready(function() {
      $('#scrappedAssetsTable').DataTable();
    });
